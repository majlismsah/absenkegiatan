<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Absensi QR Scanner</title>
<script src="https://unpkg.com/html5-qrcode"></script>
<style>
  body { font-family: Arial; text-align: center; padding: 20px; }
  #reader { width: 300px; margin: auto; }
  #hasil { margin-top: 15px; font-size: 16px; font-weight: bold; }
</style>
</head>
<body>
<h2>Absensi Kehadiran</h2>
<div id="reader"></div>
<div id="hasil">Hasil scan akan muncul di sini...</div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbyaDyuvhzr1CqwcvcHeHZIWzqPMICZ64w7T7qTcln2VHu86BQY-OTIXP0wpJgT9abmX/exec"; // ganti dengan URL GAS deploy

function handleScan(decodedText) {
  document.getElementById("hasil").innerText = "Hasil scan: " + decodedText;

  const [nama, majlis] = decodedText.split(",");
  if (!nama || !majlis) {
    alert("Format QR salah. Harus: Nama,Majlis");
    return;
  }

  fetch(scriptURL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ nama: nama.trim(), majlis: majlis.trim() })
  })
  .then(res => res.json())
  .then(resJson => {
    console.log("Response:", resJson);
    alert("Server balas: " + JSON.stringify(resJson));
  })
  .catch(err => {
    console.error("Fetch error:", err);
    alert("Fetch error: " + err);
  });
}

// init scanner
const scanner = new Html5Qrcode("reader");
Html5Qrcode.getCameras().then(cameras => {
  if (cameras && cameras.length) {
    scanner.start(
      cameras[0].id,
      { fps: 10, qrbox: 250 },
      handleScan
    );
  } else {
    alert("Kamera tidak ditemukan!");
  }
}).catch(err => console.error(err));
</script>
</body>
</html>
